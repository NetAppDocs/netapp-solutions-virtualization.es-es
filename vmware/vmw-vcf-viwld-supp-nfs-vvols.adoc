---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nfs-vvols.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc 
summary:  
---
= Agregue NFS y vVols como almacenamiento complementario a los dominios de carga de trabajo VI mediante ONTAP tools for VMware vSphere
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
En este caso de uso, describimos el procedimiento para utilizar ONTAP Tools for VMware para agregar almacenes de datos NFS y vVols como almacenamiento complementario para un dominio de carga de trabajo de infraestructura virtual (VI) de VMware Cloud Foundation (VCF).  Este procedimiento resume la implementación de ONTAP Tools para VMware vSphere, la configuración de una máquina virtual de almacenamiento (SVM) con interfaces lógicas NFS y el aprovisionamiento de almacenes de datos NFS y vVols .

*NFS* se utiliza como protocolo de almacenamiento para el almacén de datos vVols .



== Beneficios de NFS

*Simplicidad y facilidad de uso:* NFS es fácil de configurar y administrar, lo que lo convierte en una excelente opción para entornos que requieren compartir archivos de manera rápida y sencilla.

*Escalabilidad:* La arquitectura de ONTAP permite que NFS escale de manera eficiente, soportando las crecientes necesidades de datos sin cambios significativos en la infraestructura.

*Flexibilidad:* NFS admite una amplia gama de aplicaciones y cargas de trabajo, lo que lo hace versátil para diversos casos de uso, incluidos entornos virtualizados.

Para obtener más información, consulte la link:vmw-vvf-overview.html["Guía de referencia de NFS v3 para vSphere 8"] .



== Descripción general del escenario

Este escenario cubre los siguientes pasos de alto nivel:

* Cree una máquina virtual de almacenamiento (SVM) con interfaces lógicas (LIF) para el tráfico NFS.
* Cree un grupo de puertos distribuidos para la red NFS en el dominio de carga de trabajo VI.
* Cree un adaptador vmkernel para NFS en los hosts ESXi para el dominio de carga de trabajo VI.
* Implementar herramientas ONTAP en el dominio de carga de trabajo VI.
* Cree un nuevo almacén de datos NFS en el dominio de carga de trabajo VI.
* Cree un nuevo almacén de datos vVols en el dominio de carga de trabajo VI.




== Prerrequisitos

Este escenario requiere los siguientes componentes y configuraciones:

* Un sistema de almacenamiento ONTAP AFF o FAS con puertos de datos físicos en conmutadores Ethernet dedicados al tráfico de almacenamiento.
* La implementación del dominio de administración de VCF está completa y el cliente vSphere es accesible.
* Previamente se ha implementado un dominio de carga de trabajo VI.


NetApp recomienda diseños de red redundantes para NFS, que brindan tolerancia a fallas para sistemas de almacenamiento, conmutadores, adaptadores de red y sistemas host.  Es común implementar NFS con una sola subred o múltiples subredes según los requisitos arquitectónicos.

Referirse a https://www.vmware.com/docs/vmw-best-practices-running-nfs-vmware-vsphere["Mejores prácticas para ejecutar NFS con VMware vSphere"] para obtener información detallada específica de VMware vSphere.

Para obtener orientación sobre la red acerca del uso de ONTAP con VMware vSphere, consulte la https://docs.netapp.com/us-en/ontap-apps-dbs/vmware/vmware-vsphere-network.html#nfs["Configuración de red - NFS"] sección de la documentación de aplicaciones empresariales de NetApp .

Esta documentación demuestra el proceso de creación de una nueva SVM y la especificación de la información de la dirección IP para crear múltiples LIF para el tráfico NFS.  Para agregar nuevos LIF a un SVM existente, consultelink:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Crear una LIF (interfaz de red)"] .

Para obtener información completa sobre el uso de NFS con clústeres de vSphere, consulte lalink:vmw-vvf-overview.html["Guía de referencia de NFS v3 para vSphere 8"] .

{nbsp}image:vmware-vcf-aff-070.png["Diagrama de arquitectura NFS"] {nbsp}



== Pasos de implementación

Para implementar ONTAP Tools y usarlo para crear un almacén de datos vVols y NFS en el dominio de administración de VCF, complete los siguientes pasos:



=== Crear SVM y LIF en el sistema de almacenamiento ONTAP

El siguiente paso se realiza en ONTAP System Manager.

.Cree la máquina virtual de almacenamiento y los LIF
[%collapsible%open]
====
Complete los siguientes pasos para crear una SVM junto con múltiples LIF para el tráfico NFS.

. Desde el Administrador del sistema ONTAP , navegue hasta *Máquinas virtuales de almacenamiento* en el menú de la izquierda y haga clic en *+ Agregar* para comenzar.
+
image:vmware-vcf-asa-001.png["Haga clic en +Agregar para comenzar a crear SVM"]

+
{nbsp}

. En el asistente *Agregar VM de almacenamiento*, proporcione un *Nombre* para la SVM, seleccione el *Espacio IP* y luego, en *Protocolo de acceso*, haga clic en la pestaña *SMB/CIFS, NFS, S3* y marque la casilla para *Habilitar NFS*.
+
image:vmware-vcf-aff-035.png["Asistente para agregar máquinas virtuales de almacenamiento: habilitar NFS"]

+

TIP: No es necesario marcar el botón *Permitir acceso de cliente NFS* aquí, ya que Ontap Tools para VMware vSphere se utilizará para automatizar el proceso de implementación del almacén de datos.  Esto incluye proporcionar acceso de cliente para los hosts ESXi.  & # 160;

. En la sección *Interfaz de red*, complete la *Dirección IP*, la *Máscara de subred* y el *Dominio de transmisión y puerto* para el primer LIF.  Para los LIF posteriores, la casilla de verificación se puede habilitar para utilizar configuraciones comunes en todos los LIF restantes o utilizar configuraciones separadas.
+
image:vmware-vcf-aff-036.png["Complete la información de la red para LIF"]

+
{nbsp}

. Elija si desea habilitar la cuenta de administración de Storage VM (para entornos de múltiples inquilinos) y haga clic en *Guardar* para crear la SVM.
+
image:vmware-vcf-asa-004.png["Habilitar cuenta SVM y Finalizar"]



====


==== Configurar la red para NFS en hosts ESXi

Los siguientes pasos se realizan en el clúster de dominio de carga de trabajo VI mediante el cliente vSphere.  En este caso, se utiliza vCenter Single Sign-On para que el cliente vSphere sea común en los dominios de administración y carga de trabajo.

.Crear un grupo de puertos distribuidos para el tráfico NFS
[%collapsible%open]
====
Complete lo siguiente para crear un nuevo grupo de puertos distribuidos para que la red transporte tráfico NFS:

. Desde el cliente vSphere, navegue a *Inventario > Redes* para el dominio de carga de trabajo.  Navegue hasta el conmutador distribuido existente y elija la acción para crear *Nuevo grupo de puertos distribuidos...*.
+
image:vmware-vcf-asa-022.png["Elija crear un nuevo grupo de puertos"]

+
{nbsp}

. En el asistente *Nuevo grupo de puertos distribuidos*, complete un nombre para el nuevo grupo de puertos y haga clic en *Siguiente* para continuar.
. En la página *Configurar ajustes* complete todas las configuraciones.  Si se utilizan VLAN, asegúrese de proporcionar la ID de VLAN correcta. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-023.png["Complete el ID de VLAN"]

+
{nbsp}

. En la página *Listo para completar*, revise los cambios y haga clic en *Finalizar* para crear el nuevo grupo de puertos distribuidos.
. Una vez creado el grupo de puertos, navegue hasta el grupo de puertos y seleccione la acción *Editar configuración...*.
+
image:vmware-vcf-aff-037.png["DPG - editar configuración"]

+
{nbsp}

. En la página *Grupo de puertos distribuidos - Editar configuración*, navegue hasta *Equipo y conmutación por error* en el menú de la izquierda.  Habilite la formación de equipos para los enlaces ascendentes que se utilizarán para el tráfico NFS asegurándose de que estén juntos en el área *Enlaces ascendentes activos*.  Mueva los enlaces ascendentes no utilizados a *Enlaces ascendentes no utilizados*.
+
image:vmware-vcf-aff-038.png["DPG - enlaces ascendentes del equipo"]

+
{nbsp}

. Repita este proceso para cada host ESXi del clúster.


====
.Cree un adaptador VMkernel en cada host ESXi
[%collapsible%open]
====
Repita este proceso en cada host ESXi en el dominio de carga de trabajo.

. Desde el cliente vSphere, navegue a uno de los hosts ESXi en el inventario del dominio de carga de trabajo.  Desde la pestaña *Configurar* seleccione *Adaptadores VMkernel* y haga clic en *Agregar red...* para comenzar.
+
image:vmware-vcf-asa-030.png["Iniciar el asistente para agregar redes"]

+
{nbsp}

. En la ventana *Seleccionar tipo de conexión* elija *Adaptador de red VMkernel* y haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-008.png["Elija el adaptador de red VMkernel"]

+
{nbsp}

. En la página *Seleccionar dispositivo de destino*, elija uno de los grupos de puertos distribuidos para NFS que se crearon anteriormente.
+
image:vmware-vcf-aff-039.png["Seleccione el grupo de puertos de destino"]

+
{nbsp}

. En la página *Propiedades del puerto* mantenga los valores predeterminados (sin servicios habilitados) y haga clic en *Siguiente* para continuar.
. En la página de *Configuración de IPv4*, complete la *dirección IP*, la *Máscara de subred* y proporcione una nueva dirección IP de puerta de enlace (solo si es necesario). Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-aff-040.png["Configuración de IPv4 de VMkernel"]

+
{nbsp}

. Revise sus selecciones en la página *Listo para completar* y haga clic en *Finalizar* para crear el adaptador VMkernel.
+
image:vmware-vcf-aff-041.png["Revisar las selecciones de VMkernel"]



====


=== Implementar y usar herramientas ONTAP para configurar el almacenamiento

Los siguientes pasos se realizan en el clúster de dominio de administración de VCF mediante el cliente vSphere e implican la implementación de OTV, la creación de un almacén de datos NFS vVols y la migración de las máquinas virtuales de administración al nuevo almacén de datos.

Para los dominios de carga de trabajo VI, OTV se instala en el clúster de administración de VCF, pero se registra en el vCenter asociado con el dominio de carga de trabajo VI.

Para obtener información adicional sobre la implementación y el uso de herramientas ONTAP en un entorno de varios vCenter, consultelink:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/concept_requirements_for_registering_vsc_in_multiple_vcenter_servers_environment.html["Requisitos para registrar herramientas ONTAP en entornos de múltiples servidores vCenter"] .

.Implementar ONTAP tools for VMware vSphere
[%collapsible%open]
====
Las ONTAP tools for VMware vSphere (OTV) se implementan como un dispositivo de VM y proporcionan una interfaz de usuario vCenter integrada para administrar el almacenamiento de ONTAP .

Complete lo siguiente para implementar ONTAP tools for VMware vSphere:

. Obtenga la imagen OVA de las herramientas ONTAP desdelink:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab["Sitio de soporte de NetApp"] y descargar a una carpeta local.
. Inicie sesión en el dispositivo vCenter para el dominio de administración de VCF.
. Desde la interfaz del dispositivo vCenter, haga clic con el botón derecho en el clúster de administración y seleccione *Implementar plantilla OVF…*
+
image:vmware-vcf-aff-021.png["Implementar plantilla OVF..."]

+
{nbsp}

. En el asistente *Implementar plantilla OVF*, haga clic en el botón de opción *Archivo local* y seleccione el archivo OVA de las herramientas ONTAP descargado en el paso anterior.
+
image:vmware-vcf-aff-022.png["Seleccionar archivo OVA"]

+
{nbsp}

. Para los pasos 2 a 5 del asistente, seleccione un nombre y una carpeta para la máquina virtual, seleccione el recurso computacional, revise los detalles y acepte el acuerdo de licencia.
. Para la ubicación de almacenamiento de los archivos de configuración y de disco, seleccione el almacén de datos vSAN del clúster de dominio de administración de VCF.
+
image:vmware-vcf-aff-023.png["Seleccionar archivo OVA"]

+
{nbsp}

. En la página Seleccionar red, seleccione la red utilizada para administrar el tráfico.
+
image:vmware-vcf-aff-024.png["Seleccionar red"]

+
{nbsp}

. En la página Personalizar plantilla, complete toda la información requerida:
+
** Contraseña que se utilizará para el acceso administrativo a OTV.
** Dirección IP del servidor NTP.
** Contraseña de la cuenta de mantenimiento de OTV.
** Contraseña de OTV Derby DB.
** No marque la casilla para *Habilitar VMware Cloud Foundation (VCF)*.  El modo VCF no es necesario para implementar almacenamiento complementario.
** FQDN o dirección IP del dispositivo vCenter para el *VI Workload Domain*
** Credenciales para el dispositivo vCenter del *VI Workload Domain*
** Proporcione los campos de propiedades de red requeridos.
+
Haga clic en *Siguiente* para continuar.

+
image:vmware-vcf-aff-025.png["Personalizar plantilla OTV 1"]

+
image:vmware-vcf-asa-035.png["Personalizar plantilla OTV 2"]

+
{nbsp}



. Revise toda la información en la página Listo para completar y haga clic en Finalizar para comenzar a implementar el dispositivo OTV.


====
.Agregue un sistema de almacenamiento a ONTAP Tools.
[%collapsible%open]
====
. Acceda a las herramientas de NetApp ONTAP seleccionándolas en el menú principal en el cliente vSphere.
+
image:vmware-asa-006.png["Herramientas NetApp ONTAP"]

+
{nbsp}

. Desde el menú desplegable *INSTANCIA* en la interfaz de la herramienta ONTAP , seleccione la instancia de OTV asociada con el dominio de carga de trabajo que se administrará.
+
image:vmware-vcf-asa-036.png["Elija una instancia de OTV"]

+
{nbsp}

. En Herramientas de ONTAP , seleccione *Sistemas de almacenamiento* en el menú de la izquierda y luego presione *Agregar*.
+
image:vmware-vcf-asa-037.png["Agregar sistema de almacenamiento"]

+
{nbsp}

. Complete la dirección IP, las credenciales del sistema de almacenamiento y el número de puerto.  Haga clic en *Agregar* para iniciar el proceso de descubrimiento.
+
image:vmware-vcf-asa-038.png["Proporcionar credenciales del sistema de almacenamiento"]



====
.Crear un almacén de datos NFS en ONTAP Tools
[%collapsible%open]
====
Complete los siguientes pasos para implementar un almacén de datos ONTAP , que se ejecuta en NFS, utilizando las herramientas ONTAP .

. En Herramientas de ONTAP , seleccione *Descripción general* y en la pestaña *Introducción* haga clic en *Aprovisionamiento* para iniciar el asistente.
+
image:vmware-vcf-asa-041.png["Aprovisionamiento de almacén de datos"]

+
{nbsp}

. En la página *General* del asistente Nuevo almacén de datos, seleccione el centro de datos o el destino del clúster de vSphere.  Seleccione *NFS* como tipo de almacén de datos, complete un nombre para el almacén de datos y seleccione el protocolo.  Elija si desea utilizar volúmenes FlexGroup y si desea utilizar un archivo de capacidad de almacenamiento para el aprovisionamiento. Haga clic en *Siguiente* para continuar.
+
Nota: Si selecciona *Distribuir los datos del almacén de datos en todo el clúster*, el volumen subyacente se creará como un volumen FlexGroup , lo que impide el uso de perfiles de capacidad de almacenamiento.  Referirse a https://docs.netapp.com/us-en/ontap/flexgroup/supported-unsupported-config-concept.html["Configuraciones compatibles y no compatibles con volúmenes FlexGroup"] para obtener más información sobre el uso de volúmenes FlexGroup .

+
image:vmware-vcf-aff-042.png["Página general"]

+
{nbsp}

. En la página *Sistema de almacenamiento*, seleccione un perfil de capacidad de almacenamiento, el sistema de almacenamiento y SVM. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-aff-043.png["Sistema de almacenamiento"]

+
{nbsp}

. En la página *Atributos de almacenamiento* seleccione el agregado a utilizar y luego haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-aff-044.png["Atributos de almacenamiento"]

+
{nbsp}

. Por último, revise el *Resumen* y haga clic en Finalizar para comenzar a crear el almacén de datos NFS.
+
image:vmware-vcf-aff-045.png["Resumen y finalización de la revisión"]



====
.Crear un almacén de datos vVols en ONTAP Tools
[%collapsible%open]
====
Para crear un almacén de datos vVols en ONTAP Tools, complete los siguientes pasos:

. En Herramientas de ONTAP , seleccione *Descripción general* y en la pestaña *Introducción* haga clic en *Aprovisionamiento* para iniciar el asistente.
+
image:vmware-vcf-asa-041.png["Aprovisionamiento de almacén de datos"]

. En la página *General* del asistente Nuevo almacén de datos, seleccione el centro de datos o el destino del clúster de vSphere.  Seleccione * vVols* como el tipo de almacén de datos, complete un nombre para el almacén de datos y seleccione *NFS* como protocolo. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-aff-046.png["Página general"]

. En la página *Sistema de almacenamiento*, seleccione un perfil de capacidad de almacenamiento, el sistema de almacenamiento y SVM. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-aff-043.png["Sistema de almacenamiento"]

. En la página *Atributos de almacenamiento*, seleccione crear un nuevo volumen para el almacén de datos y complete los atributos de almacenamiento del volumen que se creará.  Haga clic en *Agregar* para crear el volumen y luego en *Siguiente* para continuar.
+
image:vmware-vcf-aff-047.png["Atributos de almacenamiento"]

+
image:vmware-vcf-aff-048.png["Atributos de almacenamiento - Siguiente"]

. Por último, revise el *Resumen* y haga clic en *Finalizar* para iniciar el proceso de creación del almacén de datos vVol.
+
image:vmware-vcf-aff-049.png["Página de resumen"]



====


== Información adicional

Para obtener información sobre la configuración de los sistemas de almacenamiento ONTAP , consultelink:https://docs.netapp.com/us-en/ontap["Documentación de ONTAP 9"] centro.

Para obtener información sobre la configuración de VCF, consultelink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["Documentación de VMware Cloud Foundation"] .

---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nvme.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= Agregue NVMe sobre TCP como almacenamiento complementario a los dominios de carga de trabajo de VI
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
En este caso de uso, describimos el procedimiento para utilizar ONTAP Tools for VMware para configurar NVMe sobre TCP (NVMe/TCP) como almacenamiento complementario para un dominio de carga de trabajo de infraestructura virtual (VI) de VMware Cloud Foundation (VCF).  Este procedimiento resume la configuración de una máquina virtual de almacenamiento (SVM) habilitada para NVMe/TCP, la creación de espacios de nombres NVMe, la configuración de la red del host ESXi y la implementación de un almacén de datos VMFS.



== Beneficios de NVMe sobre TCP

*Alto rendimiento:* Ofrece un rendimiento excepcional con baja latencia y altas tasas de transferencia de datos.  Esto es crucial para aplicaciones exigentes y operaciones de datos a gran escala.

*Escalabilidad:* Admite configuraciones escalables, lo que permite a los administradores de TI expandir su infraestructura sin problemas a medida que crecen los requisitos de datos.

*Rentable:* Se ejecuta a través de conmutadores Ethernet estándar y está encapsulado dentro de datagramas TCP.  No se requiere equipo especial para implementarlo.

Para obtener más información sobre los beneficios de NVMe, consulte https://www.netapp.com/data-storage/nvme/what-is-nvme/["¿Qué es NVME?"]



== Descripción general del escenario

Este escenario cubre los siguientes pasos de alto nivel:

* Cree una máquina virtual de almacenamiento (SVM) con interfaces lógicas (LIF) para el tráfico NVMe/TCP.
* Cree grupos de puertos distribuidos para redes iSCSI en el dominio de carga de trabajo VI.
* Cree adaptadores vmkernel para iSCSI en los hosts ESXi para el dominio de carga de trabajo VI.
* Agregar adaptadores NVMe/TCP en hosts ESXi.
* Implementar almacén de datos NVMe/TCP.




== Prerrequisitos

Este escenario requiere los siguientes componentes y configuraciones:

* Un sistema de almacenamiento ONTAP AFF o ASA con puertos de datos físicos en conmutadores Ethernet dedicados al tráfico de almacenamiento.
* La implementación del dominio de administración de VCF está completa y el cliente vSphere es accesible.
* Previamente se ha implementado un dominio de carga de trabajo VI.


NetApp recomienda diseños de red totalmente redundantes para NVMe/TCP.  El siguiente diagrama ilustra un ejemplo de una configuración redundante, que proporciona tolerancia a fallas para sistemas de almacenamiento, conmutadores, adaptadores de red y sistemas host.  Consulte NetApplink:https://docs.netapp.com/us-en/ontap/san-config/index.html["Referencia de configuración de SAN"] Para obtener información adicional.

image:vmware-vcf-asa-074.png["Diseño de red NVMe-tcp"]

Para rutas múltiples y conmutación por error en múltiples rutas, NetApp recomienda tener un mínimo de dos LIF por nodo de almacenamiento en redes Ethernet separadas para todas las SVM en configuraciones NVMe/TCP.

Esta documentación demuestra el proceso de creación de una nueva SVM y la especificación de la información de la dirección IP para crear múltiples LIF para el tráfico NVMe/TCP.  Para agregar nuevos LIF a un SVM existente, consultelink:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Crear una LIF (interfaz de red)"] .

Para obtener información adicional sobre las consideraciones de diseño de NVMe para los sistemas de almacenamiento ONTAP , consultelink:https://docs.netapp.com/us-en/ontap/nvme/support-limitations.html["Configuración, soporte y limitaciones de NVMe"] .



== Pasos de implementación

Para crear un almacén de datos VMFS en un dominio de carga de trabajo VCF mediante NVMe/TCP, complete los siguientes pasos.



=== Crear espacios de nombres SVM, LIF y NVMe en el sistema de almacenamiento ONTAP

El siguiente paso se realiza en ONTAP System Manager.

.Cree la máquina virtual de almacenamiento y los LIF
[%collapsible%open]
====
Complete los siguientes pasos para crear una SVM junto con múltiples LIF para el tráfico NVMe/TCP.

. Desde el Administrador del sistema ONTAP , navegue hasta *Máquinas virtuales de almacenamiento* en el menú de la izquierda y haga clic en *+ Agregar* para comenzar.
+
image:vmware-vcf-asa-001.png["Haga clic en +Agregar para comenzar a crear SVM"]

+
{nbsp}

. En el asistente *Agregar VM de almacenamiento*, proporcione un *Nombre* para la SVM, seleccione el *Espacio de IP* y luego, en *Protocolo de acceso*, haga clic en la pestaña *NVMe* y marque la casilla para *Habilitar NVMe/TCP*.
+
image:vmware-vcf-asa-075.png["Asistente para agregar máquinas virtuales de almacenamiento: habilitar NVMe/TCP"]

+
{nbsp}

. En la sección *Interfaz de red*, complete la *Dirección IP*, la *Máscara de subred* y el *Dominio de transmisión y puerto* para el primer LIF.  Para los LIF posteriores, la casilla de verificación se puede habilitar para utilizar configuraciones comunes en todos los LIF restantes o utilizar configuraciones separadas.
+

NOTE: Para rutas múltiples y conmutación por error en múltiples rutas, NetApp recomienda tener un mínimo de dos LIF por nodo de almacenamiento en redes Ethernet separadas para todas las SVM en configuraciones NVMe/TCP.

+
image:vmware-vcf-asa-076.png["Complete la información de la red para LIF"]

+
{nbsp}

. Elija si desea habilitar la cuenta de administración de Storage VM (para entornos de múltiples inquilinos) y haga clic en *Guardar* para crear la SVM.
+
image:vmware-vcf-asa-004.png["Habilitar cuenta SVM y Finalizar"]



====
.Crear el espacio de nombres NVMe
[%collapsible%open]
====
Los espacios de nombres NVMe son análogos a los LUN para iSCSi o FC.  Se debe crear el espacio de nombres NVMe antes de poder implementar un almacén de datos VMFS desde vSphere Client.  Para crear el espacio de nombres NVMe, primero se debe obtener el nombre calificado NVMe (NQN) de cada host ESXi en el clúster.  ONTAP utiliza NQN para proporcionar control de acceso al espacio de nombres.

Complete los siguientes pasos para crear un espacio de nombres NVMe:

. Abra una sesión SSH con un host ESXi en el clúster para obtener su NQN.  Utilice el siguiente comando desde la CLI:
+
[source, cli]
----
esxcli nvme info get
----
+
Debería mostrarse una salida similar a la siguiente:

+
[source, cli]
----
Host NQN: nqn.2014-08.com.netapp.sddc:nvme:vcf-wkld-esx01
----
. Registre el NQN para cada host ESXi en el clúster
. Desde el Administrador del sistema ONTAP , navegue hasta *Espacios de nombres NVMe* en el menú de la izquierda y haga clic en *+ Agregar* para comenzar.
+
image:vmware-vcf-asa-093.png["Haga clic en +Agregar para crear un espacio de nombres NVMe"]

+
{nbsp}

. En la página *Agregar espacio de nombres NVMe*, complete un prefijo de nombre, la cantidad de espacios de nombres a crear, el tamaño del espacio de nombres y el sistema operativo host que accederá al espacio de nombres.  En la sección *Host NQN*, cree una lista separada por comas de los NQN recopilados previamente de los hosts ESXi que accederán a los espacios de nombres.


Haga clic en *Más opciones* para configurar elementos adicionales como la política de protección de instantáneas.  Por último, haga clic en *Guardar* para crear el espacio de nombres NVMe.

+image:vmware-vcf-asa-093.png["Haga clic en +Agregar para crear un espacio de nombres NVMe"]

====


=== Configurar adaptadores de software NVMe y de red en hosts ESXi

Los siguientes pasos se realizan en el clúster de dominio de carga de trabajo VI mediante el cliente vSphere.  En este caso, se utiliza vCenter Single Sign-On para que el cliente vSphere sea común a los dominios de administración y de carga de trabajo.

.Crear grupos de puertos distribuidos para el tráfico NVME/TCP
[%collapsible%open]
====
Complete lo siguiente para crear un nuevo grupo de puertos distribuidos para cada red NVMe/TCP:

. Desde el cliente vSphere, navegue a *Inventario > Redes* para el dominio de carga de trabajo.  Navegue hasta el conmutador distribuido existente y elija la acción para crear *Nuevo grupo de puertos distribuidos...*.
+
image:vmware-vcf-asa-022.png["Elija crear un nuevo grupo de puertos"]

+
{nbsp}

. En el asistente *Nuevo grupo de puertos distribuidos*, complete un nombre para el nuevo grupo de puertos y haga clic en *Siguiente* para continuar.
. En la página *Configurar ajustes* complete todas las configuraciones.  Si se utilizan VLAN, asegúrese de proporcionar la ID de VLAN correcta. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-023.png["Complete el ID de VLAN"]

+
{nbsp}

. En la página *Listo para completar*, revise los cambios y haga clic en *Finalizar* para crear el nuevo grupo de puertos distribuidos.
. Repita este proceso para crear un grupo de puertos distribuidos para la segunda red NVMe/TCP que se esté utilizando y asegúrese de haber ingresado el *VLAN ID* correcto.
. Una vez que se hayan creado ambos grupos de puertos, navegue hasta el primer grupo de puertos y seleccione la acción *Editar configuración...*.
+
image:vmware-vcf-asa-077.png["DPG - editar configuración"]

+
{nbsp}

. En la página *Grupo de puertos distribuidos - Editar configuración*, navegue a *Equipo y conmutación por error* en el menú de la izquierda y haga clic en *uplink2* para moverlo hacia abajo a *Enlaces ascendentes no utilizados*.
+
image:vmware-vcf-asa-078.png["mover uplink2 a no utilizado"]

. Repita este paso para el segundo grupo de puertos NVMe/TCP.  Sin embargo, esta vez mueva *uplink1* a *Unused uplinks*.
+
image:vmware-vcf-asa-079.png["mover el enlace ascendente 1 a no utilizado"]



====
.Cree adaptadores VMkernel en cada host ESXi
[%collapsible%open]
====
Repita este proceso en cada host ESXi en el dominio de carga de trabajo.

. Desde el cliente vSphere, navegue a uno de los hosts ESXi en el inventario del dominio de carga de trabajo.  Desde la pestaña *Configurar* seleccione *Adaptadores VMkernel* y haga clic en *Agregar red...* para comenzar.
+
image:vmware-vcf-asa-030.png["Iniciar el asistente para agregar redes"]

+
{nbsp}

. En la ventana *Seleccionar tipo de conexión* elija *Adaptador de red VMkernel* y haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-008.png["Elija el adaptador de red VMkernel"]

+
{nbsp}

. En la página *Seleccionar dispositivo de destino*, elija uno de los grupos de puertos distribuidos para iSCSI que se crearon anteriormente.
+
image:vmware-vcf-asa-095.png["Seleccione el grupo de puertos de destino"]

+
{nbsp}

. En la página *Propiedades del puerto*, haga clic en el cuadro *NVMe sobre TCP* y haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-096.png["Propiedades del puerto VMkernel"]

+
{nbsp}

. En la página de *Configuración de IPv4*, complete la *dirección IP*, la *Máscara de subred* y proporcione una nueva dirección IP de puerta de enlace (solo si es necesario). Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-097.png["Configuración de IPv4 de VMkernel"]

+
{nbsp}

. Revise sus selecciones en la página *Listo para completar* y haga clic en *Finalizar* para crear el adaptador VMkernel.
+
image:vmware-vcf-asa-098.png["Revisar las selecciones de VMkernel"]

+
{nbsp}

. Repita este proceso para crear un adaptador VMkernel para la segunda red iSCSI.


====
.Agregar adaptador NVMe sobre TCP
[%collapsible%open]
====
Cada host ESXi en el clúster de dominio de carga de trabajo debe tener un adaptador de software NVMe sobre TCP instalado para cada red NVMe/TCP establecida dedicada al tráfico de almacenamiento.

Para instalar adaptadores NVMe sobre TCP y descubrir los controladores NVMe, complete los siguientes pasos:

. En el cliente vSphere, navegue a uno de los hosts ESXi en el clúster del dominio de carga de trabajo.  Desde la pestaña *Configurar*, haga clic en *Adaptadores de almacenamiento* en el menú y luego, en el menú desplegable *Agregar adaptador de software*, seleccione *Agregar adaptador NVMe sobre TCP*.
+
image:vmware-vcf-asa-099.png["Agregar adaptador NVMe sobre TCP"]

+
{nbsp}

. En la ventana *Agregar software adaptador NVMe sobre TCP*, acceda al menú desplegable *Adaptador de red física* y seleccione el adaptador de red física correcto en el cual desea habilitar el adaptador NVMe.
+
image:vmware-vcf-asa-100.png["Seleccionar adaptador físico"]

+
{nbsp}

. Repita este proceso para la segunda red asignada al tráfico NVMe sobre TCP, asignando el adaptador físico correcto.
. Seleccione uno de los adaptadores NVMe sobre TCP recién instalados y, en la pestaña *Controladores*, seleccione *Agregar controlador*.
+
image:vmware-vcf-asa-101.png["Agregar controlador"]

+
{nbsp}

. En la ventana *Agregar controlador*, seleccione la pestaña *Automáticamente* y complete los siguientes pasos.
+
** Complete una dirección IP para una de las interfaces lógicas SVM en la misma red que el adaptador físico asignado a este adaptador NVMe sobre TCP.
** Haga clic en el botón *Descubrir controladores*.
** En la lista de controladores descubiertos, haga clic en la casilla de verificación de los dos controladores con direcciones de red alineadas con este adaptador NVMe sobre TCP.
** Haga clic en el botón *Aceptar* para agregar los controladores seleccionados.
+
image:vmware-vcf-asa-102.png["Descubra y agregue controladores"]

+
{nbsp}



. Después de unos segundos deberías ver el espacio de nombres NVMe aparecer en la pestaña Dispositivos.
+
image:vmware-vcf-asa-103.png["Espacio de nombres NVMe listado en dispositivos"]

+
{nbsp}

. Repita este procedimiento para crear un adaptador NVMe sobre TCP para la segunda red establecida para el tráfico NVMe/TCP.


====
.Implementar un almacén de datos NVMe sobre TCP
[%collapsible%open]
====
Para crear un almacén de datos VMFS en el espacio de nombres NVMe, complete los siguientes pasos:

. En el cliente vSphere, navegue a uno de los hosts ESXi en el clúster del dominio de carga de trabajo.  Desde el menú *Acciones*, seleccione *Almacenamiento > Nuevo almacén de datos...*.
+
image:vmware-vcf-asa-104.png["Agregar adaptador NVMe sobre TCP"]

+
{nbsp}

. En el asistente *Nuevo almacén de datos*, seleccione *VMFS* como tipo. Haga clic en *Siguiente* para continuar.
. En la página *Selección de nombre y dispositivo*, proporcione un nombre para el almacén de datos y seleccione el espacio de nombres NVMe de la lista de dispositivos disponibles.
+
image:vmware-vcf-asa-105.png["Selección de nombre y dispositivo"]

+
{nbsp}

. En la página *Versión VMFS*, seleccione la versión de VMFS para el almacén de datos.
. En la página *Configuración de partición*, realice los cambios que desee en el esquema de partición predeterminado. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-106.png["Configuración de la partición NVMe"]

+
{nbsp}

. En la página *Listo para completar*, revise el resumen y haga clic en *Finalizar* para crear el almacén de datos.
. Navegue hasta el nuevo almacén de datos en el inventario y haga clic en la pestaña *Hosts*.  Si se configura correctamente, todos los hosts ESXi del clúster deberían aparecer en la lista y tener acceso al nuevo almacén de datos.
+
image:vmware-vcf-asa-107.png["Hosts conectados al almacén de datos"]

+
{nbsp}



====


== Información adicional

Para obtener información sobre la configuración de los sistemas de almacenamiento ONTAP , consultelink:https://docs.netapp.com/us-en/ontap["Documentación de ONTAP 9"] centro.

Para obtener información sobre la configuración de VCF, consultelink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["Documentación de VMware Cloud Foundation"] .

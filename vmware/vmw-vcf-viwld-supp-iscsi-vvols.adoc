---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-iscsi-vvols.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= Agregue vVols como almacenamiento complementario a los dominios de carga de trabajo VI mediante ONTAP tools for VMware vSphere
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
En este caso de uso, describimos el procedimiento para configurar un almacén de datos vVols con iSCSI para almacenamiento complementario en un dominio de carga de trabajo de infraestructura virtual (VI) de VMware Cloud Foundation (VCF).  Este procedimiento resume la configuración de la red iSCSI, la implementación de ONTAP Tools para VMware vSphere y el aprovisionamiento del almacén de datos vVols .

*iSCSI* se utiliza como protocolo de almacenamiento para el almacén de datos vVols .



== Beneficios de iSCSI

*Alto rendimiento:* Ofrece un alto rendimiento para brindar velocidades de transferencia de datos rápidas y eficientes y baja latencia.  Ideal para aplicaciones empresariales exigentes y entornos virtualizados.

*Facilidad de administración:* Simplifica la gestión del almacenamiento mediante el uso de herramientas y protocolos familiares basados en IP.

*Rentable:* Utiliza la infraestructura Ethernet existente, lo que reduce la necesidad de hardware especializado y permite a las organizaciones lograr soluciones de almacenamiento confiables y escalables.

Para obtener más información sobre el uso de iSCSI con sistemas de almacenamiento NetApp , consulte https://docs.netapp.com/us-en/ontap/san-admin/san-host-provisioning-concept.html["Aprovisionamiento de SAN con iSCSI"] .



== Descripción general del escenario

Este escenario cubre los siguientes pasos de alto nivel:

* Cree una máquina virtual de almacenamiento (SVM) con interfaces lógicas (LIF) para el tráfico iSCSI.
* Cree grupos de puertos distribuidos para redes iSCSI en el dominio de carga de trabajo VI.
* Cree adaptadores vmkernel para iSCSI en los hosts ESXi para el dominio de carga de trabajo VI.
* Implementar herramientas ONTAP en el dominio de carga de trabajo VI.
* Cree un nuevo almacén de datos vVols en el dominio de carga de trabajo VI.




== Prerrequisitos

Este escenario requiere los siguientes componentes y configuraciones:

* Un sistema de almacenamiento ONTAP AFF o ASA con puertos de datos físicos en conmutadores Ethernet dedicados al tráfico de almacenamiento.
* La implementación del dominio de administración de VCF está completa y el cliente vSphere es accesible.
* Previamente se ha implementado un dominio de carga de trabajo VI.


NetApp recomienda diseños de red totalmente redundantes para iSCSI.  El siguiente diagrama ilustra un ejemplo de una configuración redundante, que proporciona tolerancia a fallas para sistemas de almacenamiento, conmutadores, adaptadores de red y sistemas host.  Consulte NetApplink:https://docs.netapp.com/us-en/ontap/san-config/index.html["Referencia de configuración de SAN"] Para obtener información adicional.

image:vmware-vcf-asa-074.png["Diseño de red NVMe-tcp"]

{nbsp}

Para rutas múltiples y conmutación por error en múltiples rutas, NetApp recomienda tener un mínimo de dos LIF por nodo de almacenamiento en redes Ethernet separadas para todas las SVM en configuraciones iSCSI.

Esta documentación demuestra el proceso de creación de una nueva SVM y la especificación de la información de la dirección IP para crear múltiples LIF para el tráfico iSCSI.  Para agregar nuevos LIF a un SVM existente, consultelink:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Crear una LIF (interfaz de red)"] .


TIP: En situaciones donde se configuran varios adaptadores VMkernel en la misma red IP, se recomienda utilizar la vinculación de puertos iSCSI de software en los hosts ESXi para garantizar que se produzca un equilibrio de carga entre los adaptadores.  Consulte el artículo de Knowledge Baselink:https://knowledge.broadcom.com/external/article?legacyId=2038869["Consideraciones para el uso de la vinculación de puertos iSCSI de software en ESX/ESXi (2038869)"] .

Para obtener información adicional sobre el uso de almacenes de datos iSCSI VMFS con VMware, consultelink:vmw-vmfs-iscsi.html["vSphere VMFS Datastore: backend de almacenamiento iSCSI con ONTAP"] .



== Pasos de implementación

Para implementar ONTAP Tools y usarlo para crear un almacén de datos vVols en el dominio de administración de VCF, complete los siguientes pasos:



=== Crear SVM y LIF en el sistema de almacenamiento ONTAP

El siguiente paso se realiza en ONTAP System Manager.

.Cree la máquina virtual de almacenamiento y los LIF
[%collapsible%open]
====
Complete los siguientes pasos para crear una SVM junto con múltiples LIF para el tráfico iSCSI.

. Desde el Administrador del sistema ONTAP , navegue hasta *Máquinas virtuales de almacenamiento* en el menú de la izquierda y haga clic en *+ Agregar* para comenzar.
+
image:vmware-vcf-asa-001.png["Haga clic en +Agregar para comenzar a crear SVM"]

+
{nbsp}

. En el asistente *Agregar VM de almacenamiento*, proporcione un *Nombre* para la SVM, seleccione el *Espacio IP* y luego, en *Protocolo de acceso*, haga clic en la pestaña *iSCSI* y marque la casilla para *Habilitar iSCSI*.
+
image:vmware-vcf-asa-002.png["Asistente para agregar máquinas virtuales de almacenamiento: habilitar iSCSI"]

+
{nbsp}

. En la sección *Interfaz de red*, complete la *Dirección IP*, la *Máscara de subred* y el *Dominio de transmisión y puerto* para el primer LIF.  Para los LIF posteriores, la casilla de verificación se puede habilitar para utilizar configuraciones comunes en todos los LIF restantes o utilizar configuraciones separadas.
+

NOTE: Para rutas múltiples y conmutación por error en múltiples rutas, NetApp recomienda tener un mínimo de dos LIF por nodo de almacenamiento en redes Ethernet separadas para todas las SVM en configuraciones iSCSI.

+
image:vmware-vcf-asa-003.png["Complete la información de la red para LIF"]

+
{nbsp}

. Elija si desea habilitar la cuenta de administración de Storage VM (para entornos de múltiples inquilinos) y haga clic en *Guardar* para crear la SVM.
+
image:vmware-vcf-asa-004.png["Habilitar cuenta SVM y Finalizar"]



====


=== Configurar la red para iSCSI en hosts ESXi

Los siguientes pasos se realizan en el clúster de dominio de carga de trabajo VI mediante el cliente vSphere.  En este caso, se utiliza vCenter Single Sign-On para que el cliente vSphere sea común en los dominios de administración y carga de trabajo.

.Crear grupos de puertos distribuidos para el tráfico iSCSI
[%collapsible%open]
====
Complete lo siguiente para crear un nuevo grupo de puertos distribuidos para cada red iSCSI:

. Desde el cliente vSphere, navegue a *Inventario > Redes* para el dominio de carga de trabajo.  Navegue hasta el conmutador distribuido existente y elija la acción para crear *Nuevo grupo de puertos distribuidos...*.
+
image:vmware-vcf-asa-022.png["Elija crear un nuevo grupo de puertos"]

+
{nbsp}

. En el asistente *Nuevo grupo de puertos distribuidos*, complete un nombre para el nuevo grupo de puertos y haga clic en *Siguiente* para continuar.
. En la página *Configurar ajustes* complete todas las configuraciones.  Si se utilizan VLAN, asegúrese de proporcionar la ID de VLAN correcta. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-023.png["Complete el ID de VLAN"]

+
{nbsp}

. En la página *Listo para completar*, revise los cambios y haga clic en *Finalizar* para crear el nuevo grupo de puertos distribuidos.
. Repita este proceso para crear un grupo de puertos distribuidos para la segunda red iSCSI que se esté utilizando y asegúrese de haber ingresado el *VLAN ID* correcto.
. Una vez que se hayan creado ambos grupos de puertos, navegue hasta el primer grupo de puertos y seleccione la acción *Editar configuración...*.
+
image:vmware-vcf-asa-024.png["DPG - editar configuración"]

+
{nbsp}

. En la página *Grupo de puertos distribuidos - Editar configuración*, navegue a *Equipo y conmutación por error* en el menú de la izquierda y haga clic en *uplink2* para moverlo hacia abajo a *Enlaces ascendentes no utilizados*.
+
image:vmware-vcf-asa-025.png["mover uplink2 a no utilizado"]

. Repita este paso para el segundo grupo de puertos iSCSI.  Sin embargo, esta vez mueva *uplink1* a *Unused uplinks*.
+
image:vmware-vcf-asa-026.png["mover uplink1 a no utilizado"]



====
.Cree adaptadores VMkernel en cada host ESXi
[%collapsible%open]
====
Repita este proceso en cada host ESXi en el dominio de carga de trabajo.

. Desde el cliente vSphere, navegue a uno de los hosts ESXi en el inventario del dominio de carga de trabajo.  Desde la pestaña *Configurar* seleccione *Adaptadores VMkernel* y haga clic en *Agregar red...* para comenzar.
+
image:vmware-vcf-asa-030.png["Iniciar el asistente para agregar redes"]

+
{nbsp}

. En la ventana *Seleccionar tipo de conexión* elija *Adaptador de red VMkernel* y haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-008.png["Elija el adaptador de red VMkernel"]

+
{nbsp}

. En la página *Seleccionar dispositivo de destino*, elija uno de los grupos de puertos distribuidos para iSCSI que se crearon anteriormente.
+
image:vmware-vcf-asa-031.png["Seleccione el grupo de puertos de destino"]

+
{nbsp}

. En la página *Propiedades del puerto* mantenga los valores predeterminados y haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-032.png["Propiedades del puerto VMkernel"]

+
{nbsp}

. En la página de *Configuración de IPv4*, complete la *dirección IP*, la *Máscara de subred* y proporcione una nueva dirección IP de puerta de enlace (solo si es necesario). Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-033.png["Configuración de IPv4 de VMkernel"]

+
{nbsp}

. Revise sus selecciones en la página *Listo para completar* y haga clic en *Finalizar* para crear el adaptador VMkernel.
+
image:vmware-vcf-asa-034.png["Revisar las selecciones de VMkernel"]

+
{nbsp}

. Repita este proceso para crear un adaptador VMkernel para la segunda red iSCSI.


====


=== Implementar y usar herramientas ONTAP para configurar el almacenamiento

Los siguientes pasos se realizan en el clúster de dominio de administración de VCF mediante el cliente vSphere e implican la implementación de ONTAP Tools, la creación de un almacén de datos iSCSI de vVols y la migración de las máquinas virtuales de administración al nuevo almacén de datos.

Para los dominios de carga de trabajo VI, ONTAP Tools se instala en el clúster de administración de VCF, pero se registra en el vCenter asociado con el dominio de carga de trabajo VI.

Para obtener información adicional sobre la implementación y el uso de herramientas ONTAP en un entorno de varios vCenter, consultelink:https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/concept_requirements_for_registering_vsc_in_multiple_vcenter_servers_environment.html["Requisitos para registrar herramientas ONTAP en entornos de múltiples servidores vCenter"] .

.Implementar ONTAP tools for VMware vSphere
[%collapsible%open]
====
Las ONTAP tools for VMware vSphere se implementan como un dispositivo de VM y proporcionan una interfaz de usuario vCenter integrada para administrar el almacenamiento de ONTAP .

Complete lo siguiente para implementar ONTAP tools for VMware vSphere:

. Obtenga la imagen OVA de las herramientas ONTAP desdelink:https://mysupport.netapp.com/site/products/all/details/otv/downloads-tab["Sitio de soporte de NetApp"] y descargar a una carpeta local.
. Inicie sesión en el dispositivo vCenter para el dominio de administración de VCF.
. Desde la interfaz del dispositivo vCenter, haga clic con el botón derecho en el clúster de administración y seleccione *Implementar plantilla OVF…*
+
image:vmware-vcf-aff-021.png["Implementar plantilla OVF..."]

+
{nbsp}

. En el asistente *Implementar plantilla OVF*, haga clic en el botón de opción *Archivo local* y seleccione el archivo OVA de las herramientas ONTAP descargado en el paso anterior.
+
image:vmware-vcf-aff-022.png["Seleccionar archivo OVA"]

+
{nbsp}

. Para los pasos 2 a 5 del asistente, seleccione un nombre y una carpeta para la máquina virtual, seleccione el recurso computacional, revise los detalles y acepte el acuerdo de licencia.
. Para la ubicación de almacenamiento de los archivos de configuración y de disco, seleccione el almacén de datos vSAN del clúster de dominio de administración de VCF.
+
image:vmware-vcf-aff-023.png["Seleccionar archivo OVA"]

+
{nbsp}

. En la página Seleccionar red, seleccione la red utilizada para administrar el tráfico.
+
image:vmware-vcf-aff-024.png["Seleccionar red"]

+
{nbsp}

. En la página Personalizar plantilla, complete toda la información requerida:
+
** Contraseña que se utilizará para el acceso administrativo a las herramientas ONTAP .
** Dirección IP del servidor NTP.
** Contraseña de la cuenta de mantenimiento de ONTAP Tools.
** Contraseña de base de datos Derby de herramientas ONTAP .
** No marque la casilla para *Habilitar VMware Cloud Foundation (VCF)*.  El modo VCF no es necesario para implementar almacenamiento complementario.
** FQDN o dirección IP del dispositivo vCenter para el *VI Workload Domain*
** Credenciales para el dispositivo vCenter del *VI Workload Domain*
** Proporcione los campos de propiedades de red requeridos.
+
Haga clic en *Siguiente* para continuar.

+
image:vmware-vcf-aff-025.png["Personalizar plantilla OTV 1"]

+
image:vmware-vcf-asa-035.png["Personalizar plantilla OTV 2"]

+
{nbsp}



. Revise toda la información en la página Listo para completar y haga clic en Finalizar para comenzar a implementar el dispositivo ONTAP Tools.


====
.Agregue un sistema de almacenamiento a ONTAP Tools.
[%collapsible%open]
====
. Acceda a las herramientas de NetApp ONTAP seleccionándolas en el menú principal en el cliente vSphere.
+
image:vmware-asa-006.png["Herramientas NetApp ONTAP"]

+
{nbsp}

. Desde el menú desplegable *INSTANCIA* en la interfaz de ONTAP Tool, seleccione la instancia de ONTAP Tools asociada con el dominio de carga de trabajo que se administrará.
+
image:vmware-vcf-asa-036.png["Elija una instancia de OTV"]

+
{nbsp}

. En Herramientas de ONTAP , seleccione *Sistemas de almacenamiento* en el menú de la izquierda y luego presione *Agregar*.
+
image:vmware-vcf-asa-037.png["Agregar sistema de almacenamiento"]

+
{nbsp}

. Complete la dirección IP, las credenciales del sistema de almacenamiento y el número de puerto.  Haga clic en *Agregar* para iniciar el proceso de descubrimiento.
+

NOTE: vVol requiere credenciales de clúster ONTAP en lugar de credenciales SVM.  Para obtener más información, consulte https://docs.netapp.com/us-en/ontap-tools-vmware-vsphere/configure/task_add_storage_systems.html["Añadir sistemas de almacenamiento"] En la documentación de herramientas de ONTAP .

+
image:vmware-vcf-asa-038.png["Proporcionar credenciales del sistema de almacenamiento"]



====
.Crear un perfil de capacidad de almacenamiento en ONTAP Tools
[%collapsible%open]
====
Los perfiles de capacidad de almacenamiento describen las características que ofrece una matriz de almacenamiento o un sistema de almacenamiento.  Incluyen definiciones de calidad de servicio y se utilizan para seleccionar sistemas de almacenamiento que cumplen los parámetros definidos en el perfil.  Se puede utilizar uno de los perfiles proporcionados o se pueden crear otros nuevos.

Para crear un perfil de capacidad de almacenamiento en ONTAP Tools, complete los siguientes pasos:

. En Herramientas de ONTAP , seleccione *Perfil de capacidad de almacenamiento* en el menú de la izquierda y luego presione *Crear*.
+
image:vmware-vcf-asa-039.png["Perfil de capacidad de almacenamiento"]

. En el asistente *Crear perfil de capacidad de almacenamiento* proporcione un nombre y una descripción del perfil y haga clic en *Siguiente*.
+
image:vmware-asa-010.png["Añadir nombre para SCP"]

. Seleccione el tipo de plataforma y especifique que el sistema de almacenamiento será una matriz SAN All-Flash y configure *Asimétrico* como falso.
+
image:vmware-asa-011.png["Plataforma para SCP"]

. A continuación, seleccione la elección del protocolo o *Cualquiera* para permitir todos los protocolos posibles. Haga clic en *Siguiente* para continuar.
+
image:vmware-asa-012.png["Protocolo para SCP"]

. La página de *rendimiento* permite configurar la calidad del servicio en forma de IOP mínimas y máximas permitidas.
+
image:vmware-asa-013.png["Calidad de servicio para SCP"]

. Complete la página de *atributos de almacenamiento* seleccionando la eficiencia del almacenamiento, la reserva de espacio, el cifrado y cualquier política de niveles según sea necesario.
+
image:vmware-asa-014.png["Atributos para SCP"]

. Por último, revise el resumen y haga clic en Finalizar para crear el perfil.
+
image:vmware-vcf-asa-040.png["Resumen para SCP"]



====
.Crear un almacén de datos vVols en ONTAP Tools
[%collapsible%open]
====
Para crear un almacén de datos vVols en ONTAP Tools, complete los siguientes pasos:

. En Herramientas de ONTAP , seleccione *Descripción general* y en la pestaña *Introducción* haga clic en *Aprovisionamiento* para iniciar el asistente.
+
image:vmware-vcf-asa-041.png["Aprovisionamiento de almacén de datos"]

. En la página *General* del asistente Nuevo almacén de datos, seleccione el centro de datos o el destino del clúster de vSphere.  Seleccione * vVols* como el tipo de almacén de datos, complete un nombre para el almacén de datos y seleccione *iSCSI* como protocolo. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-042.png["Página general"]

. En la página *Sistema de almacenamiento*, seleccione un perfil de capacidad de almacenamiento, el sistema de almacenamiento y SVM. Haga clic en *Siguiente* para continuar.
+
image:vmware-vcf-asa-043.png["Sistema de almacenamiento"]

. En la página *Atributos de almacenamiento*, seleccione crear un nuevo volumen para el almacén de datos y complete los atributos de almacenamiento del volumen que se creará.  Haga clic en *Agregar* para crear el volumen y luego en *Siguiente* para continuar.
+
image:vmware-vcf-asa-044.png["Atributos de almacenamiento"]

. Por último, revise el resumen y haga clic en *Finalizar* para iniciar el proceso de creación del almacén de datos vVol.
+
image:vmware-vcf-asa-045.png["Página de resumen"]



====


== Información adicional

Para obtener información sobre la configuración de los sistemas de almacenamiento ONTAP , consultelink:https://docs.netapp.com/us-en/ontap["Documentación de ONTAP 9"] centro.

Para obtener información sobre la configuración de VCF, consultelink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["Documentación de VMware Cloud Foundation"] .
